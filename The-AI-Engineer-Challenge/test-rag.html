<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG System Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input[type="file"] { margin: 10px 0; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        .result { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>RAG System Test Page</h1>
    <p>This page will test if your RAG backend is working properly.</p>
    
    <div class="test-section">
        <h2>1. Health Check Test</h2>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <div id="healthResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. PDF Upload Test</h2>
        <input type="file" id="pdfFile" accept=".pdf">
        <button onclick="testPdfUpload()">Test PDF Upload</button>
        <div id="pdfResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. RAG Chat Test</h2>
        <textarea id="ragMessage" placeholder="Enter your question about the uploaded document..."></textarea>
        <button onclick="testRagChat()">Test RAG Chat</button>
        <div id="ragResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Regular Chat Test</h2>
        <textarea id="chatMessage" placeholder="Enter a regular chat message..."></textarea>
        <button onclick="testRegularChat()">Test Regular Chat</button>
        <div id="chatResult" class="result"></div>
    </div>

    <script>
        const BACKEND_URL = 'https://api-op1fvgw4x-tyroneinozs-projects.vercel.app';
        
        async function testHealth() {
            const resultDiv = document.getElementById('healthResult');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();
                resultDiv.innerHTML = `<div class="success">✅ SUCCESS: ${JSON.stringify(data)}</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ ERROR: ${error.message}</div>`;
            }
        }
        
        async function testPdfUpload() {
            const resultDiv = document.getElementById('pdfResult');
            const fileInput = document.getElementById('pdfFile');
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = '<div class="error">❌ Please select a PDF file first</div>';
                return;
            }
            
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                const response = await fetch(`${BACKEND_URL}/api/upload-pdf`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<div class="success">✅ SUCCESS: ${JSON.stringify(data)}</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ ERROR: ${error.message}</div>`;
            }
        }
        
        async function testRagChat() {
            const resultDiv = document.getElementById('ragResult');
            const message = document.getElementById('ragMessage').value;
            
            if (!message.trim()) {
                resultDiv.innerHTML = '<div class="error">❌ Please enter a message first</div>';
                return;
            }
            
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/rag-chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_message: message,
                        api_key: '',
                        model: 'gpt-3.5-turbo'
                    })
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<div class="success">✅ SUCCESS: ${JSON.stringify(data)}</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ ERROR: ${error.message}</div>`;
            }
        }
        
        async function testRegularChat() {
            const resultDiv = document.getElementById('chatResult');
            const message = document.getElementById('chatMessage').value;
            
            if (!message.trim()) {
                resultDiv.innerHTML = '<div class="error">❌ Please enter a message first</div>';
                return;
            }
            
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_message: message,
                        api_key: '',
                        model: 'gpt-3.5-turbo',
                        developer_message: 'You are a helpful AI assistant.'
                    })
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<div class="success">✅ SUCCESS: ${JSON.stringify(data)}</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ ERROR: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
